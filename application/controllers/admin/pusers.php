<?phpif (!defined('BASEPATH'))    exit('No direct script access allowed');class Pusers extends MY_Controller {    public function __construct() {        parent::__construct();        $this->load->model('user_model', 'User');    }    public function login() {        if ($this->ahruser->IsAdmin('Loggedin')) {            $this->ahruser->Admin('LoginRedirect');        }        $this->layout = CPREFIX . '/login';        $this->template = false;        $validate = $this->form_validation->set_rules('username', '', 'required')->set_rules('password', '', 'required')->run();        if ($validate) {            $row = $this->User->row(array('conditions' => array(                        'username' => $this->ahrform->get('username'),                        'password' =>  $this->ahruser->password($this->ahrform->get('password')),                        'user_type' => 1,                    )));//            pr($row);//            exit();            //if user informations exist in the database.            if (empty($row)) {                //if user informations does not exist in the database. Then set worning                $this->ahrsession->set('warning', array("Invalid username & password."));            } else {                $ip = empty($_SERVER['REMOTE_ADDR']) ? '127.0.0.0' : $_SERVER['REMOTE_ADDR'];                $this->User->set('last_login_time', date("Y_m_d_H_i_s"));                $this->User->set('last_login_ip', $ip);                $date = date("Y_m_d_H_i_s");                //$this->db->query("UPDATE fmp_users SET last_logged_in_time = '$date', last_login_ip = '$ip' WHERE id = $row->id");                $this->ahruser->Admin('Login', $row->id);                $this->ahrsession->set('Admin', $row->id);                $this->ahruser->Admin('LoginRedirect');            }            return;        }        else if(!empty ($_POST))            $this->ahrsession->set('warning', array("Invalid username & password."));    }    public function logout() {        $this->ahruser->Admin('Logout');    }}